<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="jquery-3.7.1.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
          rel="stylesheet" 
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" 
          crossorigin="anonymous">
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
          integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" 
          crossorigin="anonymous"></script>

  <style type="text/css">
    .currentChoice {
      margin-top: 10px;
      width: 80%;
      background-color: gray;
      padding: 10px;
    }

    .history-container {
      height: 500px;
      overflow-y:scroll;
      position: relative;
    }
    .history-container thead {
      position:sticky;
      top: 0;
      background-color: whitesmoke;
    }
  </style>

</head>
<body>

<form>
  <select name="table" id="tableSelector">
    <option value="">Select Table:</option>
    <option>Portal</option>
    <option>Island</option>
    <option>New</option>
    <option>Portal2</option>
  </select>
  <input type="number" id="areaCode">
</form>
<br>
<div class="history-container">
  <table>
    <thead>
      <tr>
        <th>Area</th>
        <th>choice1</th>
        <th>link1</th>
        <th>choice2</th>
        <th>link2</th>
      </tr>
    </thead>
    <tbody id="history">

    </tbody>
  </table>
</div>

<div class="currentChoice container p-3 mt-4 border main-box">
  <table id="data">

  </table>
</div>
<!-- <div id="txtHint"><b>Person info will be listed here...</b></div> -->

<script>

var id = 0;

function showUser(str,table) {
  if (str == "") {
    document.getElementById("history").innerHTML = "";
    return;
  } else {
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        // document.getElementById("data").innerHTML = this.responseText;
        $("#history").append(this.responseText);
        $("#data").html(this.responseText);
      }
    };
    xmlhttp.open("GET",`ajax.php?id=${str}&table=${table}`,true);
    xmlhttp.send();
  }
}

$("#areaCode").on("change", function() {
  let value = $(this).val();
  id = value;
  let table = $("#tableSelector").val();
  showUser(value, table);
})

$(document).on("click", ".currentChoice button", function() {
  let value = $(this).data("link");
  let table = $("#tableSelector").val();
  let choice = $(this).data("choice");

  $("#" + id).css("background-color", "lightblue");
  $(`#${id} button`).each(function() {
    if ($(this).data("choice") != choice) {
      $(this).remove();
    }
  })

  if (value != 0) { 
    showUser(value, table);
    id = value;
    console.log(id);
  } else {
    // let choice = $(this).data("choice");
    let old = $(this).parents("tr").attr("id");
    console.log(choice, old, table, this);
    newPath(choice, old, table)
  }
})

function newPath(choice, oldId, table) {
  let html = `<form method='post' action='addPath.php'>
                <label for='description'>What happens?</label>
                <textarea id='area' name='description' class='form-control'></textarea>
                <label for='option1' class=>Path 1</label>
                <input type='text' id='option1' name='option1' class='form-control'>
                <label for='option2'>Path 2</label>
                <input type='text' id='option2' name='option2' class='form-control'>
                <input type='text' id='author' name='author' class='form-control w-50 float-end mt-1' value='$username'>
                <label for='author' class='float-end mt-2'>Author: </label>
                <input type='hidden' name='old' value='${oldId}'>
                <input type='hidden' name='choice' value='${choice}'>
                <input type='hidden' name='table' value='${table}'>
                <input type='submit' name='submit' id='submit' class='btn btn-primary form-control mt-2'>
              </form>`;

  $(".main-box").html(html);

  // $(".main-box").on("click", "submit", function() {
  //   var xmlhttp = new XMLHttpRequest();
  //   xmlhttp.onreadystatechange = function() {
  //     if (this.readyState == 4 && this.status == 200) {
  //       // document.getElementById("data").innerHTML = this.responseText;
  //       window.reload();
  //     }
  //   };
  //   xmlhttp.open("GET",`addPath.php?oldId=${str}&table=${table}&choice=${choice}`,true);
  //   xmlhttp.send();
  // })

}

</script>

</body>
</html>